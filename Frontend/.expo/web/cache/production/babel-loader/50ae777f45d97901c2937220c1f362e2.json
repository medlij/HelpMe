{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _wrapNativeSuper from\"@babel/runtime/helpers/wrapNativeSuper\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import _regeneratorRuntime from\"@babel/runtime/regenerator\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import{PermissionStatus}from'unimodules-permissions-interface';import{LocationAccuracy}from\"./Location.types\";import{LocationEventEmitter}from\"./LocationEventEmitter\";var GeocoderError=function(_Error){_inherits(GeocoderError,_Error);var _super=_createSuper(GeocoderError);function GeocoderError(){var _this;_classCallCheck(this,GeocoderError);_this=_super.call(this,'Geocoder service is not available for this device.');_this.code='E_NO_GEOCODER';return _this;}return GeocoderError;}(_wrapNativeSuper(Error));function geolocationPositionToJSON(position){var coords=position.coords,timestamp=position.timestamp;return{coords:{latitude:coords.latitude,longitude:coords.longitude,altitude:coords.altitude,accuracy:coords.accuracy,altitudeAccuracy:coords.altitudeAccuracy,heading:coords.heading,speed:coords.speed},timestamp:timestamp};}function isLocationValid(location,options){var _location$coords$accu;var maxAge=typeof options.maxAge==='number'?options.maxAge:Infinity;var requiredAccuracy=typeof options.requiredAccuracy==='number'?options.requiredAccuracy:Infinity;var locationAccuracy=(_location$coords$accu=location.coords.accuracy)!=null?_location$coords$accu:Infinity;return Date.now()-location.timestamp<=maxAge&&locationAccuracy<=requiredAccuracy;}function getPermissionsAsync(){return _regeneratorRuntime.async(function getPermissionsAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",new Promise(function(resolve){var resolveWithStatus=function resolveWithStatus(status){return resolve({status:status,granted:status===PermissionStatus.GRANTED,canAskAgain:true,expires:0});};navigator.geolocation.getCurrentPosition(function(){return resolveWithStatus(PermissionStatus.GRANTED);},function(_ref){var code=_ref.code;if(code===1){resolveWithStatus(PermissionStatus.DENIED);}else{resolveWithStatus(PermissionStatus.UNDETERMINED);}},{enableHighAccuracy:false,maximumAge:Infinity});}));case 1:case\"end\":return _context.stop();}}},null,null,null,Promise);}var lastKnownPosition=null;export default{get name(){return'ExpoLocation';},getProviderStatusAsync:function getProviderStatusAsync(){return _regeneratorRuntime.async(function getProviderStatusAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",{locationServicesEnabled:'geolocation'in navigator});case 1:case\"end\":return _context2.stop();}}},null,null,null,Promise);},getLastKnownPositionAsync:function getLastKnownPositionAsync(){var options,_args3=arguments;return _regeneratorRuntime.async(function getLastKnownPositionAsync$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:options=_args3.length>0&&_args3[0]!==undefined?_args3[0]:{};if(!(lastKnownPosition&&isLocationValid(lastKnownPosition,options))){_context3.next=3;break;}return _context3.abrupt(\"return\",lastKnownPosition);case 3:return _context3.abrupt(\"return\",null);case 4:case\"end\":return _context3.stop();}}},null,null,null,Promise);},getCurrentPositionAsync:function getCurrentPositionAsync(options){return _regeneratorRuntime.async(function getCurrentPositionAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",new Promise(function(resolve,reject){var _options$accuracy;var resolver=function resolver(position){lastKnownPosition=geolocationPositionToJSON(position);resolve(lastKnownPosition);};navigator.geolocation.getCurrentPosition(resolver,reject,_objectSpread({maximumAge:Infinity,enableHighAccuracy:((_options$accuracy=options.accuracy)!=null?_options$accuracy:0)>LocationAccuracy.Balanced},options));}));case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);},removeWatchAsync:function removeWatchAsync(watchId){return _regeneratorRuntime.async(function removeWatchAsync$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:navigator.geolocation.clearWatch(watchId);case 1:case\"end\":return _context5.stop();}}},null,null,null,Promise);},watchDeviceHeading:function watchDeviceHeading(headingId){return _regeneratorRuntime.async(function watchDeviceHeading$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:console.warn('Location.watchDeviceHeading: is not supported on web');case 1:case\"end\":return _context6.stop();}}},null,null,null,Promise);},hasServicesEnabledAsync:function hasServicesEnabledAsync(){return _regeneratorRuntime.async(function hasServicesEnabledAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:return _context7.abrupt(\"return\",'geolocation'in navigator);case 1:case\"end\":return _context7.stop();}}},null,null,null,Promise);},geocodeAsync:function geocodeAsync(){return _regeneratorRuntime.async(function geocodeAsync$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:throw new GeocoderError();case 1:case\"end\":return _context8.stop();}}},null,null,null,Promise);},reverseGeocodeAsync:function reverseGeocodeAsync(){return _regeneratorRuntime.async(function reverseGeocodeAsync$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:throw new GeocoderError();case 1:case\"end\":return _context9.stop();}}},null,null,null,Promise);},watchPositionImplAsync:function watchPositionImplAsync(watchId,options){return _regeneratorRuntime.async(function watchPositionImplAsync$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:return _context10.abrupt(\"return\",new Promise(function(resolve){watchId=global.navigator.geolocation.watchPosition(function(position){lastKnownPosition=geolocationPositionToJSON(position);LocationEventEmitter.emit('Expo.locationChanged',{watchId:watchId,location:lastKnownPosition});},undefined,options);resolve(watchId);}));case 1:case\"end\":return _context10.stop();}}},null,null,null,Promise);},getPermissionsAsync:getPermissionsAsync,requestPermissionsAsync:function requestPermissionsAsync(){return _regeneratorRuntime.async(function requestPermissionsAsync$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:return _context11.abrupt(\"return\",getPermissionsAsync());case 1:case\"end\":return _context11.stop();}}},null,null,null,Promise);},requestForegroundPermissionsAsync:function requestForegroundPermissionsAsync(){return _regeneratorRuntime.async(function requestForegroundPermissionsAsync$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:return _context12.abrupt(\"return\",getPermissionsAsync());case 1:case\"end\":return _context12.stop();}}},null,null,null,Promise);},requestBackgroundPermissionsAsync:function requestBackgroundPermissionsAsync(){return _regeneratorRuntime.async(function requestBackgroundPermissionsAsync$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:return _context13.abrupt(\"return\",getPermissionsAsync());case 1:case\"end\":return _context13.stop();}}},null,null,null,Promise);},getForegroundPermissionsAsync:function getForegroundPermissionsAsync(){return _regeneratorRuntime.async(function getForegroundPermissionsAsync$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:return _context14.abrupt(\"return\",getPermissionsAsync());case 1:case\"end\":return _context14.stop();}}},null,null,null,Promise);},getBackgroundPermissionsAsync:function getBackgroundPermissionsAsync(){return _regeneratorRuntime.async(function getBackgroundPermissionsAsync$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:return _context15.abrupt(\"return\",getPermissionsAsync());case 1:case\"end\":return _context15.stop();}}},null,null,null,Promise);},startObserving:function startObserving(){},stopObserving:function stopObserving(){}};","map":{"version":3,"sources":["../src/ExpoLocation.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { PermissionResponse, PermissionStatus } from 'unimodules-permissions-interface';\n\nimport {\n  LocationLastKnownOptions,\n  LocationObject,\n  LocationOptions,\n  LocationAccuracy,\n} from './Location.types';\nimport { LocationEventEmitter } from './LocationEventEmitter';\n\nclass GeocoderError extends Error {\n  code: string;\n\n  constructor() {\n    super('Geocoder service is not available for this device.');\n    this.code = 'E_NO_GEOCODER';\n  }\n}\n\n/**\n * Converts `GeolocationPosition` to JavaScript object.\n */\nfunction geolocationPositionToJSON(position: LocationObject): LocationObject {\n  const { coords, timestamp } = position;\n  return {\n    coords: {\n      latitude: coords.latitude,\n      longitude: coords.longitude,\n      altitude: coords.altitude,\n      accuracy: coords.accuracy,\n      altitudeAccuracy: coords.altitudeAccuracy,\n      heading: coords.heading,\n      speed: coords.speed,\n    },\n    timestamp,\n  };\n}\n\n/**\n * Checks whether given location didn't exceed given `maxAge` and fits in the required accuracy.\n */\nfunction isLocationValid(location: LocationObject, options: LocationLastKnownOptions): boolean {\n  const maxAge = typeof options.maxAge === 'number' ? options.maxAge : Infinity;\n  const requiredAccuracy =\n    typeof options.requiredAccuracy === 'number' ? options.requiredAccuracy : Infinity;\n  const locationAccuracy = location.coords.accuracy ?? Infinity;\n\n  return Date.now() - location.timestamp <= maxAge && locationAccuracy <= requiredAccuracy;\n}\n\n/**\n * Gets the permission details. The implementation is not very good as it actually requests\n * for the current location, but there is no better way on web so far :(\n */\nasync function getPermissionsAsync(): Promise<PermissionResponse> {\n  return new Promise<PermissionResponse>(resolve => {\n    const resolveWithStatus = status =>\n      resolve({\n        status,\n        granted: status === PermissionStatus.GRANTED,\n        canAskAgain: true,\n        expires: 0,\n      });\n\n    navigator.geolocation.getCurrentPosition(\n      () => resolveWithStatus(PermissionStatus.GRANTED),\n      ({ code }) => {\n        if (code === 1 /* PERMISSION_DENIED */) {\n          resolveWithStatus(PermissionStatus.DENIED);\n        } else {\n          resolveWithStatus(PermissionStatus.UNDETERMINED);\n        }\n      },\n      { enableHighAccuracy: false, maximumAge: Infinity }\n    );\n  });\n}\n\nlet lastKnownPosition: LocationObject | null = null;\n\nexport default {\n  get name(): string {\n    return 'ExpoLocation';\n  },\n  async getProviderStatusAsync(): Promise<{ locationServicesEnabled: boolean }> {\n    return {\n      locationServicesEnabled: 'geolocation' in navigator,\n    };\n  },\n  async getLastKnownPositionAsync(\n    options: LocationLastKnownOptions = {}\n  ): Promise<LocationObject | null> {\n    if (lastKnownPosition && isLocationValid(lastKnownPosition, options)) {\n      return lastKnownPosition;\n    }\n    return null;\n  },\n  async getCurrentPositionAsync(options: LocationOptions): Promise<LocationObject> {\n    return new Promise<LocationObject>((resolve, reject) => {\n      const resolver = position => {\n        lastKnownPosition = geolocationPositionToJSON(position);\n        resolve(lastKnownPosition);\n      };\n      navigator.geolocation.getCurrentPosition(resolver, reject, {\n        maximumAge: Infinity,\n        enableHighAccuracy: (options.accuracy ?? 0) > LocationAccuracy.Balanced,\n        ...options,\n      });\n    });\n  },\n  async removeWatchAsync(watchId): Promise<void> {\n    navigator.geolocation.clearWatch(watchId);\n  },\n  async watchDeviceHeading(headingId): Promise<void> {\n    console.warn('Location.watchDeviceHeading: is not supported on web');\n  },\n  async hasServicesEnabledAsync(): Promise<boolean> {\n    return 'geolocation' in navigator;\n  },\n  async geocodeAsync(): Promise<any[]> {\n    throw new GeocoderError();\n  },\n  async reverseGeocodeAsync(): Promise<any[]> {\n    throw new GeocoderError();\n  },\n  async watchPositionImplAsync(watchId: string, options: LocationOptions): Promise<string> {\n    return new Promise<string>(resolve => {\n      // @ts-ignore: the types here need to be fixed\n      watchId = global.navigator.geolocation.watchPosition(\n        position => {\n          lastKnownPosition = geolocationPositionToJSON(position);\n          LocationEventEmitter.emit('Expo.locationChanged', {\n            watchId,\n            location: lastKnownPosition,\n          });\n        },\n        undefined,\n        // @ts-ignore: the options object needs to be fixed\n        options\n      );\n      resolve(watchId);\n    });\n  },\n\n  getPermissionsAsync,\n  async requestPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n  async requestForegroundPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n  async requestBackgroundPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n  async getForegroundPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n  async getBackgroundPermissionsAsync(): Promise<PermissionResponse> {\n    return getPermissionsAsync();\n  },\n\n  // no-op\n  startObserving() {},\n  stopObserving() {},\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}