{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _defineProperty2 from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty2(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}import*as React from'react';import View from\"react-native-web/dist/exports/View\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import{NavigationHelpersContext,useTheme}from'@react-navigation/native';import{ScreenContainer,screensEnabled}from'react-native-screens';import SafeAreaProviderCompat,{initialSafeAreaInsets}from\"./SafeAreaProviderCompat\";import ResourceSavingScene from\"./ResourceSavingScene\";import BottomTabBar,{getTabBarHeight}from\"./BottomTabBar\";import BottomTabBarHeightCallbackContext from\"../utils/BottomTabBarHeightCallbackContext\";import BottomTabBarHeightContext from\"../utils/BottomTabBarHeightContext\";function SceneContent(_ref){var isFocused=_ref.isFocused,children=_ref.children,style=_ref.style;var _useTheme=useTheme(),colors=_useTheme.colors;return React.createElement(View,{accessibilityElementsHidden:!isFocused,importantForAccessibility:isFocused?'auto':'no-hide-descendants',style:[styles.content,{backgroundColor:colors.background},style]},children);}var BottomTabView=function(_React$Component){_inherits(BottomTabView,_React$Component);var _super=_createSuper(BottomTabView);function BottomTabView(_props){var _this;_classCallCheck(this,BottomTabView);_this=_super.call(this,_props);_defineProperty(_assertThisInitialized(_this),\"renderTabBar\",function(){var _this$props=_this.props,_this$props$tabBar=_this$props.tabBar,tabBar=_this$props$tabBar===void 0?function(props){return React.createElement(BottomTabBar,props);}:_this$props$tabBar,tabBarOptions=_this$props.tabBarOptions,state=_this$props.state,navigation=_this$props.navigation,descriptors=_this$props.descriptors;return tabBar(_objectSpread(_objectSpread({},tabBarOptions),{},{state:state,descriptors:descriptors,navigation:navigation}));});_defineProperty(_assertThisInitialized(_this),\"handleTabBarHeightChange\",function(height){_this.setState(function(state){if(state.tabBarHeight!==height){return{tabBarHeight:height};}return null;});});var _this$props2=_this.props,_state=_this$props2.state,_tabBarOptions=_this$props2.tabBarOptions;var dimensions=Dimensions.get('window');var tabBarHeight=getTabBarHeight({state:_state,dimensions:dimensions,layout:{width:dimensions.width,height:0},insets:initialSafeAreaInsets,adaptive:_tabBarOptions===null||_tabBarOptions===void 0?void 0:_tabBarOptions.adaptive,labelPosition:_tabBarOptions===null||_tabBarOptions===void 0?void 0:_tabBarOptions.labelPosition,tabStyle:_tabBarOptions===null||_tabBarOptions===void 0?void 0:_tabBarOptions.tabStyle,style:_tabBarOptions===null||_tabBarOptions===void 0?void 0:_tabBarOptions.style});_this.state={loaded:[_state.routes[_state.index].key],tabBarHeight:tabBarHeight};return _this;}_createClass(BottomTabView,[{key:\"render\",value:function render(){var _this$props3=this.props,state=_this$props3.state,descriptors=_this$props3.descriptors,navigation=_this$props3.navigation,lazy=_this$props3.lazy,_this$props3$detachIn=_this$props3.detachInactiveScreens,detachInactiveScreens=_this$props3$detachIn===void 0?true:_this$props3$detachIn,sceneContainerStyle=_this$props3.sceneContainerStyle;var routes=state.routes;var _this$state=this.state,loaded=_this$state.loaded,tabBarHeight=_this$state.tabBarHeight;var isScreensEnabled=(screensEnabled===null||screensEnabled===void 0?void 0:screensEnabled())&&detachInactiveScreens;return React.createElement(NavigationHelpersContext.Provider,{value:navigation},React.createElement(SafeAreaProviderCompat,null,React.createElement(ScreenContainer,{enabled:isScreensEnabled,style:styles.container},routes.map(function(route,index){var descriptor=descriptors[route.key];var unmountOnBlur=descriptor.options.unmountOnBlur;var isFocused=state.index===index;if(unmountOnBlur&&!isFocused){return null;}if(lazy&&!loaded.includes(route.key)&&!isFocused){return null;}return React.createElement(ResourceSavingScene,{key:route.key,style:StyleSheet.absoluteFill,isVisible:isFocused,enabled:isScreensEnabled},React.createElement(SceneContent,{isFocused:isFocused,style:sceneContainerStyle},React.createElement(BottomTabBarHeightContext.Provider,{value:tabBarHeight},descriptor.render())));})),React.createElement(BottomTabBarHeightCallbackContext.Provider,{value:this.handleTabBarHeightChange},this.renderTabBar())));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(nextProps,prevState){var focusedRouteKey=nextProps.state.routes[nextProps.state.index].key;return{loaded:prevState.loaded.includes(focusedRouteKey)?prevState.loaded:[].concat(_toConsumableArray(prevState.loaded),[focusedRouteKey])};}}]);return BottomTabView;}(React.Component);export{BottomTabView as default};_defineProperty(BottomTabView,\"defaultProps\",{lazy:true});var styles=StyleSheet.create({container:{flex:1,overflow:'hidden'},content:{flex:1}});","map":{"version":3,"sources":["BottomTabView.tsx"],"names":["style","colors","useTheme","isFocused","styles","backgroundColor","background","BottomTabView","React","lazy","focusedRouteKey","nextProps","loaded","prevState","constructor","state","tabBarOptions","dimensions","Dimensions","tabBarHeight","getTabBarHeight","layout","width","height","insets","adaptive","labelPosition","tabStyle","tabBar","props","descriptors","navigation","render","detachInactiveScreens","sceneContainerStyle","routes","isScreensEnabled","container","descriptor","route","unmountOnBlur","StyleSheet","handleTabBarHeightChange","flex","overflow","content"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  View,\n  StyleSheet,\n  Dimensions,\n  StyleProp,\n  ViewStyle,\n} from 'react-native';\n\nimport {\n  NavigationHelpersContext,\n  ParamListBase,\n  TabNavigationState,\n  useTheme,\n} from '@react-navigation/native';\nimport { ScreenContainer, screensEnabled } from 'react-native-screens';\n\nimport SafeAreaProviderCompat, {\n  initialSafeAreaInsets,\n} from './SafeAreaProviderCompat';\nimport ResourceSavingScene from './ResourceSavingScene';\nimport BottomTabBar, { getTabBarHeight } from './BottomTabBar';\nimport BottomTabBarHeightCallbackContext from '../utils/BottomTabBarHeightCallbackContext';\nimport BottomTabBarHeightContext from '../utils/BottomTabBarHeightContext';\nimport type {\n  BottomTabNavigationConfig,\n  BottomTabDescriptorMap,\n  BottomTabNavigationHelpers,\n  BottomTabBarProps,\n} from '../types';\n\ntype Props = BottomTabNavigationConfig & {\n  state: TabNavigationState<ParamListBase>;\n  navigation: BottomTabNavigationHelpers;\n  descriptors: BottomTabDescriptorMap;\n};\n\ntype State = {\n  loaded: string[];\n  tabBarHeight: number;\n};\n\nfunction SceneContent({\n  isFocused,\n  children,\n  style,\n}: {\n  isFocused: boolean;\n  children: React.ReactNode;\n  style?: StyleProp<ViewStyle>;\n}) {\n  const { colors } = useTheme();\n\n  return (\n    <View\n      accessibilityElementsHidden={!isFocused}\n      importantForAccessibility={isFocused ? 'auto' : 'no-hide-descendants'}\n      style={[styles.content, { backgroundColor: colors.background }, style]}\n    >\n      {children}\n    </View>\n  );\n}\n\nexport default class BottomTabView extends React.Component<Props, State> {\n  static defaultProps = {\n    lazy: true,\n  };\n\n  static getDerivedStateFromProps(nextProps: Props, prevState: State) {\n    const focusedRouteKey = nextProps.state.routes[nextProps.state.index].key;\n\n    return {\n      // Set the current tab to be loaded if it was not loaded before\n      loaded: prevState.loaded.includes(focusedRouteKey)\n        ? prevState.loaded\n        : [...prevState.loaded, focusedRouteKey],\n    };\n  }\n\n  constructor(props: Props) {\n    super(props);\n\n    const { state, tabBarOptions } = this.props;\n\n    const dimensions = Dimensions.get('window');\n    const tabBarHeight = getTabBarHeight({\n      state,\n      dimensions,\n      layout: { width: dimensions.width, height: 0 },\n      insets: initialSafeAreaInsets,\n      adaptive: tabBarOptions?.adaptive,\n      labelPosition: tabBarOptions?.labelPosition,\n      tabStyle: tabBarOptions?.tabStyle,\n      style: tabBarOptions?.style,\n    });\n\n    this.state = {\n      loaded: [state.routes[state.index].key],\n      tabBarHeight: tabBarHeight,\n    };\n  }\n\n  private renderTabBar = () => {\n    const {\n      tabBar = (props: BottomTabBarProps) => <BottomTabBar {...props} />,\n      tabBarOptions,\n      state,\n      navigation,\n      descriptors,\n    } = this.props;\n    return tabBar({\n      ...tabBarOptions,\n      state: state,\n      descriptors: descriptors,\n      navigation: navigation,\n    });\n  };\n\n  private handleTabBarHeightChange = (height: number) => {\n    this.setState((state) => {\n      if (state.tabBarHeight !== height) {\n        return { tabBarHeight: height };\n      }\n\n      return null;\n    });\n  };\n\n  render() {\n    const {\n      state,\n      descriptors,\n      navigation,\n      lazy,\n      detachInactiveScreens = true,\n      sceneContainerStyle,\n    } = this.props;\n    const { routes } = state;\n    const { loaded, tabBarHeight } = this.state;\n    const isScreensEnabled = screensEnabled?.() && detachInactiveScreens;\n\n    return (\n      <NavigationHelpersContext.Provider value={navigation}>\n        <SafeAreaProviderCompat>\n          <ScreenContainer\n            // @ts-ignore\n            enabled={isScreensEnabled}\n            style={styles.container}\n          >\n            {routes.map((route, index) => {\n              const descriptor = descriptors[route.key];\n              const { unmountOnBlur } = descriptor.options;\n              const isFocused = state.index === index;\n\n              if (unmountOnBlur && !isFocused) {\n                return null;\n              }\n\n              if (lazy && !loaded.includes(route.key) && !isFocused) {\n                // Don't render a screen if we've never navigated to it\n                return null;\n              }\n\n              return (\n                <ResourceSavingScene\n                  key={route.key}\n                  style={StyleSheet.absoluteFill}\n                  isVisible={isFocused}\n                  enabled={isScreensEnabled}\n                >\n                  <SceneContent\n                    isFocused={isFocused}\n                    style={sceneContainerStyle}\n                  >\n                    <BottomTabBarHeightContext.Provider value={tabBarHeight}>\n                      {descriptor.render()}\n                    </BottomTabBarHeightContext.Provider>\n                  </SceneContent>\n                </ResourceSavingScene>\n              );\n            })}\n          </ScreenContainer>\n          <BottomTabBarHeightCallbackContext.Provider\n            value={this.handleTabBarHeightChange}\n          >\n            {this.renderTabBar()}\n          </BottomTabBarHeightCallbackContext.Provider>\n        </SafeAreaProviderCompat>\n      </NavigationHelpersContext.Provider>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    overflow: 'hidden',\n  },\n  content: {\n    flex: 1,\n  },\n});\n"]},"metadata":{},"sourceType":"module"}