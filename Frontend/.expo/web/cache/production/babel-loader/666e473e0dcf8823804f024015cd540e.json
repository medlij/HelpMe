{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";var _MediaTypeInput;function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{Platform}from'@unimodules/core';import{PermissionStatus}from'unimodules-permissions-interface';import{v4}from'uuid';import{MediaTypeOptions}from\"./ImagePicker.types\";var MediaTypeInput=(_MediaTypeInput={},_defineProperty(_MediaTypeInput,MediaTypeOptions.All,'video/mp4,video/quicktime,video/x-m4v,video/*,image/*'),_defineProperty(_MediaTypeInput,MediaTypeOptions.Images,'image/*'),_defineProperty(_MediaTypeInput,MediaTypeOptions.Videos,'video/mp4,video/quicktime,video/x-m4v,video/*'),_MediaTypeInput);export default{get name(){return'ExponentImagePicker';},launchImageLibraryAsync:function launchImageLibraryAsync(_ref){var _ref$mediaTypes,mediaTypes,_ref$allowsMultipleSe,allowsMultipleSelection;return _regeneratorRuntime.async(function launchImageLibraryAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_ref$mediaTypes=_ref.mediaTypes,mediaTypes=_ref$mediaTypes===void 0?MediaTypeOptions.Images:_ref$mediaTypes,_ref$allowsMultipleSe=_ref.allowsMultipleSelection,allowsMultipleSelection=_ref$allowsMultipleSe===void 0?false:_ref$allowsMultipleSe;if(Platform.isDOMAvailable){_context.next=3;break;}return _context.abrupt(\"return\",{cancelled:true});case 3:_context.next=5;return _regeneratorRuntime.awrap(openFileBrowserAsync({mediaTypes:mediaTypes,allowsMultipleSelection:allowsMultipleSelection}));case 5:return _context.abrupt(\"return\",_context.sent);case 6:case\"end\":return _context.stop();}}},null,null,null,Promise);},launchCameraAsync:function launchCameraAsync(_ref2){var _ref2$mediaTypes,mediaTypes,_ref2$allowsMultipleS,allowsMultipleSelection;return _regeneratorRuntime.async(function launchCameraAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_ref2$mediaTypes=_ref2.mediaTypes,mediaTypes=_ref2$mediaTypes===void 0?MediaTypeOptions.Images:_ref2$mediaTypes,_ref2$allowsMultipleS=_ref2.allowsMultipleSelection,allowsMultipleSelection=_ref2$allowsMultipleS===void 0?false:_ref2$allowsMultipleS;if(Platform.isDOMAvailable){_context2.next=3;break;}return _context2.abrupt(\"return\",{cancelled:true});case 3:_context2.next=5;return _regeneratorRuntime.awrap(openFileBrowserAsync({mediaTypes:mediaTypes,allowsMultipleSelection:allowsMultipleSelection,capture:true}));case 5:return _context2.abrupt(\"return\",_context2.sent);case 6:case\"end\":return _context2.stop();}}},null,null,null,Promise);},getCameraPermissionsAsync:function getCameraPermissionsAsync(){return _regeneratorRuntime.async(function getCameraPermissionsAsync$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context3.stop();}}},null,null,null,Promise);},requestCameraPermissionsAsync:function requestCameraPermissionsAsync(){return _regeneratorRuntime.async(function requestCameraPermissionsAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);},getMediaLibraryPermissionsAsync:function getMediaLibraryPermissionsAsync(_writeOnly){return _regeneratorRuntime.async(function getMediaLibraryPermissionsAsync$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context5.stop();}}},null,null,null,Promise);},requestMediaLibraryPermissionsAsync:function requestMediaLibraryPermissionsAsync(_writeOnly){return _regeneratorRuntime.async(function requestMediaLibraryPermissionsAsync$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context6.stop();}}},null,null,null,Promise);}};function permissionGrantedResponse(){return{status:PermissionStatus.GRANTED,expires:'never',granted:true,canAskAgain:true};}function openFileBrowserAsync(_ref3){var mediaTypes=_ref3.mediaTypes,_ref3$capture=_ref3.capture,capture=_ref3$capture===void 0?false:_ref3$capture,_ref3$allowsMultipleS=_ref3.allowsMultipleSelection,allowsMultipleSelection=_ref3$allowsMultipleS===void 0?false:_ref3$allowsMultipleS;var mediaTypeFormat=MediaTypeInput[mediaTypes];var input=document.createElement('input');input.style.display='none';input.setAttribute('type','file');input.setAttribute('accept',mediaTypeFormat);input.setAttribute('id',v4());if(allowsMultipleSelection){input.setAttribute('multiple','multiple');}if(capture){input.setAttribute('capture','camera');}document.body.appendChild(input);return new Promise(function(resolve,reject){input.addEventListener('change',function _callee(){var img,imgs;return _regeneratorRuntime.async(function _callee$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!input.files){_context7.next=12;break;}if(allowsMultipleSelection){_context7.next=8;break;}_context7.next=4;return _regeneratorRuntime.awrap(readFile(input.files[0]));case 4:img=_context7.sent;resolve(_objectSpread({cancelled:false},img));_context7.next=12;break;case 8:_context7.next=10;return _regeneratorRuntime.awrap(Promise.all(Array.from(input.files).map(readFile)));case 10:imgs=_context7.sent;resolve({cancelled:false,selected:imgs});case 12:document.body.removeChild(input);case 13:case\"end\":return _context7.stop();}}},null,null,null,Promise);});var event=new MouseEvent('click');input.dispatchEvent(event);});}function readFile(targetFile){return new Promise(function(resolve,reject){var reader=new FileReader();reader.onerror=function(){reject(new Error(\"Failed to read the selected media because the operation failed.\"));};reader.onload=function(_ref4){var target=_ref4.target;var uri=target.result;var returnRaw=function returnRaw(){return resolve({uri:uri,width:0,height:0});};if(typeof(target==null?void 0:target.result)==='string'){var image=new Image();image.src=target.result;image.onload=function(){var _image$naturalWidth,_image$naturalHeight;return resolve({uri:uri,width:(_image$naturalWidth=image.naturalWidth)!=null?_image$naturalWidth:image.width,height:(_image$naturalHeight=image.naturalHeight)!=null?_image$naturalHeight:image.height});};image.onerror=function(){return returnRaw();};}else{returnRaw();}};reader.readAsDataURL(targetFile);});}","map":{"version":3,"sources":["../src/ExponentImagePicker.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { Platform } from '@unimodules/core';\nimport { PermissionResponse, PermissionStatus } from 'unimodules-permissions-interface';\nimport { v4 } from 'uuid';\n\nimport {\n  ExpandImagePickerResult,\n  ImageInfo,\n  ImagePickerMultipleResult,\n  ImagePickerResult,\n  MediaTypeOptions,\n  OpenFileBrowserOptions,\n} from './ImagePicker.types';\n\nconst MediaTypeInput = {\n  [MediaTypeOptions.All]: 'video/mp4,video/quicktime,video/x-m4v,video/*,image/*',\n  [MediaTypeOptions.Images]: 'image/*',\n  [MediaTypeOptions.Videos]: 'video/mp4,video/quicktime,video/x-m4v,video/*',\n};\n\nexport default {\n  get name(): string {\n    return 'ExponentImagePicker';\n  },\n\n  async launchImageLibraryAsync({\n    mediaTypes = MediaTypeOptions.Images,\n    allowsMultipleSelection = false,\n  }): Promise<ImagePickerResult | ImagePickerMultipleResult> {\n    // SSR guard\n    if (!Platform.isDOMAvailable) {\n      return { cancelled: true };\n    }\n    return await openFileBrowserAsync({\n      mediaTypes,\n      allowsMultipleSelection,\n    });\n  },\n\n  async launchCameraAsync({\n    mediaTypes = MediaTypeOptions.Images,\n    allowsMultipleSelection = false,\n  }): Promise<ImagePickerResult | ImagePickerMultipleResult> {\n    // SSR guard\n    if (!Platform.isDOMAvailable) {\n      return { cancelled: true };\n    }\n    return await openFileBrowserAsync({\n      mediaTypes,\n      allowsMultipleSelection,\n      capture: true,\n    });\n  },\n\n  /*\n   * Delegate to expo-permissions to request camera permissions\n   */\n  async getCameraPermissionsAsync() {\n    return permissionGrantedResponse();\n  },\n  async requestCameraPermissionsAsync() {\n    return permissionGrantedResponse();\n  },\n\n  /*\n   * Camera roll permissions don't need to be requested on web, so we always\n   * respond with granted.\n   */\n  async getMediaLibraryPermissionsAsync(_writeOnly: boolean) {\n    return permissionGrantedResponse();\n  },\n  async requestMediaLibraryPermissionsAsync(_writeOnly: boolean): Promise<PermissionResponse> {\n    return permissionGrantedResponse();\n  },\n};\n\nfunction permissionGrantedResponse(): PermissionResponse {\n  return {\n    status: PermissionStatus.GRANTED,\n    expires: 'never',\n    granted: true,\n    canAskAgain: true,\n  };\n}\n\nfunction openFileBrowserAsync<T extends OpenFileBrowserOptions>({\n  mediaTypes,\n  capture = false,\n  allowsMultipleSelection = false,\n}: T): Promise<ExpandImagePickerResult<T>> {\n  const mediaTypeFormat = MediaTypeInput[mediaTypes];\n\n  const input = document.createElement('input');\n  input.style.display = 'none';\n  input.setAttribute('type', 'file');\n  input.setAttribute('accept', mediaTypeFormat);\n  input.setAttribute('id', v4());\n  if (allowsMultipleSelection) {\n    input.setAttribute('multiple', 'multiple');\n  }\n  if (capture) {\n    input.setAttribute('capture', 'camera');\n  }\n  document.body.appendChild(input);\n\n  return new Promise((resolve, reject) => {\n    input.addEventListener('change', async () => {\n      if (input.files) {\n        if (!allowsMultipleSelection) {\n          const img: ImageInfo = await readFile(input.files[0]);\n          resolve({\n            cancelled: false,\n            ...img,\n          } as ExpandImagePickerResult<T>);\n        } else {\n          const imgs: ImageInfo[] = await Promise.all(Array.from(input.files).map(readFile));\n          resolve({\n            cancelled: false,\n            selected: imgs,\n          } as ExpandImagePickerResult<T>);\n        }\n      }\n      document.body.removeChild(input);\n    });\n\n    const event = new MouseEvent('click');\n    input.dispatchEvent(event);\n  });\n}\n\nfunction readFile(targetFile: Blob): Promise<ImageInfo> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onerror = () => {\n      reject(new Error(`Failed to read the selected media because the operation failed.`));\n    };\n    reader.onload = ({ target }) => {\n      const uri = (target as any).result;\n      const returnRaw = () =>\n        resolve({\n          uri,\n          width: 0,\n          height: 0,\n        });\n\n      if (typeof target?.result === 'string') {\n        const image = new Image();\n        image.src = target.result;\n        image.onload = () =>\n          resolve({\n            uri,\n            width: image.naturalWidth ?? image.width,\n            height: image.naturalHeight ?? image.height,\n          });\n        image.onerror = () => returnRaw();\n      } else {\n        returnRaw();\n      }\n    };\n\n    reader.readAsDataURL(targetFile);\n  });\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}